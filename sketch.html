<!DOCTYPE html>
<html>
<head>
    <title>Real-time Sketch to Image</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
</head>
<body>
    <h1>Real-time Sketch to Image</h1>
    <canvas id="sketchCanvas"></canvas>
    <img id="generatedImage" src="" alt="Generated Image">

    <script>
        const canvas = document.getElementById('sketchCanvas');
        const ctx = canvas.getContext('2d');

        let isDrawing = false;
        let lastX, lastY;

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);

        function startDrawing(e) {
            isDrawing = true;
            lastX = e.offsetX;
            lastY = e.offsetY;
        }

        function draw(e) {
            if (isDrawing) {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                lastX = e.offsetX;
                lastY = e.offsetY;

                sendSketchData();
            }
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function sendSketchData() {
            const imageData = canvas.toDataURL('image/png');

            fetch('/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt: "Describe the desired image", // Replace with actual prompt
                    sketch_image: imageData,
                    steps: 25, // Adjust parameters as needed
                    cfg: 7.5,
                    strength: 0.75,
                    style: "None" // Choose a style or leave as "None"
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error(data.error);
                } else {
                    document.getElementById('generatedImage').src = `data:image/jpeg;base64,${data.image}`;
                }
            });
        }
    </script>
</body>
</html>